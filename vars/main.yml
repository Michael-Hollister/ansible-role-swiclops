---

# Tells whether this role had executed or not. Toggled to `true` during runtime.
matrix_swiclops_role_executed: false

matrix_swiclops_hostname: "swiclops"
matrix_swiclops_port: 8080
matrix_swiclops_addr_with_container: "{{ matrix_swiclops_hostname }}:{{ matrix_swiclops_port }}"
matrix_swiclops_addr_sans_container: "127.0.0.1:{{ matrix_swiclops_port }}"

matrix_swiclops_uia_endpoints:
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/register
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/login
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/account/deactivate
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/account/password
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/account/auth
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/account/3pid/add
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/account/3pid/delete
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/devices/(.*)
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/delete_devices
  - ^/_matrix/client/(api/v1|r0|v3|unstable)/keys/device_signing/upload

matrix_swiclops_nginx_proxy_config_block: |
  location ~* ^({{ matrix_swiclops_uia_endpoints|join('|') }}) {
      {% if matrix_nginx_proxy_enabled %}
          {# Use the embedded DNS resolver in Docker containers to discover the service #}
          resolver 127.0.0.11 valid=5s;
          set $backend "{{ matrix_nginx_proxy_proxy_uia_addr_with_container }}";
          proxy_pass http://$backend;
      {% else %}
          {# Generic configuration for use outside of our container setup #}
          proxy_pass http://{{ matrix_nginx_proxy_proxy_uia_addr_sans_container }};
          {% endif %}

      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-For {{ matrix_nginx_proxy_x_forwarded_for }};
      proxy_set_header X-Forwarded-Proto {{ matrix_nginx_proxy_x_forwarded_proto_value }};
  }

matrix_swiclops_tmp_directory_size_mb: 100
